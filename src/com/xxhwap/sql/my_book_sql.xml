<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
		 "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="com.xxhwap.book">
<typeAlias alias="book" type="com.xxhwap.book.TudouBookInfo"/>
<resultMap class="book" id="bookMap">
	<result property="id" column="ID"/>
	<result property="tags" column="tags"/>
	<result property="isbn10" column="isbn10"/>
	<result property="isbn13" column="isbn13"/>
	<result property="title" column="title"/>
	<result property="pages" column="pages"/>
	<result property="author" column="author"/>
	<result property="price" column="price"/>
	<result property="binding" column="binding"/>
	<result property="publisher" column="publisher"/>
	<result property="pubdate" column="pubdate"/>
	<result property="summary" column="summary"/>
	<result property="imagePath" column="imagePath"/>
	<result property="school" column="school"/>
	<result property="biji" column="biji"/>
	<result property="number" column="num"/>
	<result property="mobile" column="mobile"/>
	<result property="sendTime" column="sendTime"/>
	<result property="openId" column="open_id"/>
</resultMap>
<!--查询-->
<select id='findAllList' resultMap='bookMap'>
SELECT
	id,
	tags,
	isbn10,
	isbn13,
	title,
	pages,
	author,
	price,
	binding,
	publisher,
	pubdate,
	summary,
	imagePath,
	school,
	biji,
	num,
	mobile,
	sendTime,
	open_id
	FROM
		mybook
	<dynamic prepend="WHERE">
		<isNotEmpty prepend="AND" property="openId">
			open_id=#openId#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="title">
			instr(title,#title#)>0
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="author">
			author=#author#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="publisher">
			publisher=#publisher#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="binding">
			binding=#binding#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="school">
			school=#school#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="biji">
			biji=#biji#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="number">
			num>=#number#
		</isNotEmpty>
	</dynamic>
	<dynamic prepend="limit">
		<isNotEmpty prepend="" property="count">
			 0,#count#
		</isNotEmpty>
	</dynamic>
	order by 	sendTime
</select>

<select id='findById' resultMap='bookMap'>
SELECT
	id,
	tags,
	isbn10,
	isbn13,
	title,
	pages,
	author,
	price,
	binding,
	publisher,
	pubdate,
	summary,
	imagePath,
	school,
	biji,
	num,
	mobile,
	sendTime,
	open_id
FROM mybook
	<dynamic prepend="WHERE">
		<isNotEmpty prepend="AND" property="id">
			ID=#id#
		</isNotEmpty>
	</dynamic>
	limit 0,1
</select>
<!--新增-->
<insert id="add" parameterClass="book">
	INSERT INTO mybook(
	tags,
	isbn10,
	isbn13,
	title,
	pages,
	author,
	price,
	binding,
	publisher,
	pubdate,
	summary,
	imagePath,
	school,
	biji,
	num,
	mobile,
	sendTime,
	open_id
)VALUES(
	#tags#,
	#isbn10#,
	#isbn13#,
	#title#,
	#pages#,
	#author#,
	#price#,
	#binding#,
	#publisher#,
	#pubdate#,
	#summary#,
	#imagePath#,
	#school#,
	#biji#,
	#number#,
	#mobile#,
	now(),
	#openId#
	)
	<selectKey resultClass="long" keyProperty="id">
		SELECT @@IDENTITY AS id
	</selectKey>
</insert>

</sqlMap>
